<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: 'Sarabun', sans-serif; padding: 20px; background-color: #f5f5f5; color: #333; }
        h3 { color: #2e7d32; text-align: center; margin-bottom: 20px; }
        
        .search-container { position: relative; width: 100%; }
        input { 
            width: 100%; 
            padding: 15px; 
            border-radius: 30px; 
            border: 1px solid #ddd; 
            font-size: 16px;
            box-sizing: border-box;
            outline: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        input:focus { border-color: #66bb6a; }

        #results { margin-top: 15px; }
        .result-item { 
            background: white; 
            padding: 15px; 
            margin-bottom: 10px; 
            border-radius: 10px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            cursor: pointer; 
            transition: all 0.2s;
        }
        .result-item:active { background-color: #e8f5e9; transform: scale(0.98); }
        
        .loading { text-align: center; color: #888; font-size: 14px; margin-top: 20px; }
        .hidden { display: none; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <h3>üåø ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£ & Warfarin</h3>
    
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£..." oninput="searchData()" disabled>
    </div>
    
    <div id="loading" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
    <div id="results"></div>

    <script>
        // ----------------------------------------------------
        // ‡πÉ‡∏™‡πà Web App URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô Deploy GAS ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ !!!
        // ----------------------------------------------------
        const GAS_API_URL = "https://script.google.com/macros/s/AKfycbwS1fCVXO2I9zmH-tAnqPdhxSYGmPGIIQ0FMfNjR6kb6Ft2hdHL7msTVBK_dkl52OGK/exec"; 

        let allHerbs = [];

        async function main() {
            // 1. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô LIFF
            await liff.init({ liffId: "2008726880-JRgSRcyj" });
            
            // 2. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£‡∏à‡∏≤‡∏Å Google Sheet
            try {
                const response = await fetch(GAS_API_URL);
                allHerbs = await response.json();
                
                // ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                document.getElementById('loading').classList.add('hidden');
                const input = document.getElementById('searchInput');
                input.disabled = false;
                input.focus();
            } catch (error) {
                document.getElementById('loading').innerText = "‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà";
                console.error(error);
            }
        }

        main();

        function searchData() {
            const query = document.getElementById('searchInput').value.trim();
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';

            if (query.length < 1) return;

            // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö Partial Match (‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡∏∑‡πà‡∏≠)
            const filtered = allHerbs.filter(item => item.includes(query));

            if (filtered.length === 0) {
                resultsDiv.innerHTML = '<div style="text-align:center; color:#999;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';
                return;
            }

            filtered.forEach(item => {
                const div = document.createElement('div');
                div.className = 'result-item';
                div.innerHTML = `<strong>${item}</strong>`; // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏≤
                div.onclick = () => sendToLine(item);
                resultsDiv.appendChild(div);
            });
        }

        function sendToLine(name) {
            if (!liff.isInClient()) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô LINE Application");
                return;
            }
            
            liff.sendMessages([{
                type: 'text',
                text: name 
            }]).then(() => {
                liff.closeWindow(); 
            }).catch((err) => {
                console.error('Error sending message:', err);
            });
        }
    </script>
</body>
</html>